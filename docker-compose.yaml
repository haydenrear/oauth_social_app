version: '3.4'
services:
  servicediscovery:
      build: ./servicediscovery
      # Mapping of container port to host
      ports:
        - "8761:8761"
      volumes:
        - /docker:/docker
      expose:
        - "8761"
      hostname: servicediscovery
  gateway:
      build: ./gateway
      # Mapping of container port to host
      ports:
        - "8900:8900"
      volumes:
        - /docker:/docker
      expose:
        - "8900"
      hostname: gateway
      depends_on:
        - servicediscovery
      environment:
        - eureka.client.service-url.defaultZone=http://servicediscovery:8761/eureka
  thread:
      build: ./thread
      # Mapping of container port to host
      ports:
        - "9000:9000"
      # Link database container to app container
      # for rechability.
      expose:
        - "9000"
      hostname: thread
      depends_on:
#        - mongo
        - servicediscovery
      volumes:
        - /docker:/docker
      environment:
        - eureka.client.service-url.defaultZone=http://servicediscovery:8761/eureka

  backendforfrontend:
      build: ./backendforfrontend
      # Mapping of container port to host
      ports:
        - "9002:9002"
      expose:
        - "9002"
      volumes:
        - /docker:/docker
      hostname: backendforfrontend
      depends_on:
        - gateway
        - servicediscovery
      environment:
        - eureka.client.service-url.defaultZone=http://servicediscovery:8761/eureka
        - url.threadpost.url=gateway:8900/threadpost

#  mongo:
    # image to fetch from docker hub
#    build:
#      context: ./mongo
#      dockerfile: Dockerfile-mongo
#    environment:
#      ME_CONFIG_MONGODB_ADMINUSERNAME: ***REMOVED***
#      ME_CONFIG_MONGODB_ADMINPASSWORD: ***REMOVED***
#    volumes:
#      - /docker:/docker

networks:
  this-services-network:
    driver: bridge
    name: this-services-network